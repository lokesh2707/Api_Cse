<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Medical Invoice</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f4f7fa;
    }
    .invoice-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      padding: 20px;
    }
    .invoice-header {
      font-weight: bold;
      color: #2c3e50;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .form-control, .btn {
      border-radius: 8px;
    }
    .btn-success {
      background: #27ae60;
      border: none;
    }
    .btn-success:hover {
      background: #219150;
    }
    .btn-danger {
      border-radius: 6px;
    }
    table th {
      background: #2c3e50 !important;
      color: white !important;
      text-align: center;
    }
    table td {
      vertical-align: middle;
      text-align: center;
    }
    #totalPreview {
      color: #27ae60;
      font-weight: bold;
    }
  </style>

  <script>
    function computeTotal() {
      const qty = Number(document.getElementById('qty').value || 0);
      const rate = Number(document.getElementById('rate').value || 0);
      const gst = Number(document.getElementById('gst').value || 0);
      const disc = Number(document.getElementById('discount').value || 0);

      const sub = qty * rate;
      const discAmt = sub * disc / 100;
      const taxable = sub - discAmt;
      const gstAmt = taxable * gst / 100;
      const total = taxable + gstAmt;
      document.getElementById('totalPreview').textContent = total.toFixed(2);
    }
  </script>
</head>
<body class="container mt-5">

  <div class="invoice-card">
    <h2 class="invoice-header">ðŸ§¾ Medical Invoice</h2>

    <!-- Form -->
    <form th:action="@{/invoice/add}" th:object="${newInvoice}" method="post" 
          class="row g-3 mb-4 align-items-end" oninput="computeTotal()">

      <div class="col-md-3">
        <label class="form-label">Medicine</label>
        <input type="text" th:field="*{description}" placeholder="Medicine" class="form-control" required>
      </div>
      <div class="col-md-1">
        <label class="form-label">Packing</label>
        <input type="text" th:field="*{packing}" placeholder="Packing" class="form-control">
      </div>
      <div class="col-md-1">
        <label class="form-label">Qty</label>
        <input id="qty" type="number" th:field="*{qty}" class="form-control" min="1" value="1">
      </div>
      <div class="col-md-1">
        <label class="form-label">Rate</label>
        <input id="rate" type="number" step="0.01" th:field="*{rate}" class="form-control" value="0">
      </div>
      <div class="col-md-1">
        <label class="form-label">GST%</label>
        <input id="gst" type="number" step="0.01" th:field="*{gst}" class="form-control" value="0">
      </div>
      <div class="col-md-1">
        <label class="form-label">Discount%</label>
        <input id="discount" type="number" step="0.01" th:field="*{discount}" class="form-control" value="0">
      </div>
      <div class="col-md-2">
        <label class="form-label">Expiry Date</label>
        <input type="date" th:field="*{expiryDate}" class="form-control">
      </div>
      <div class="col-md-1 d-grid">
        <button type="submit" class="btn btn-success">+ Add</button>
      </div>
      <div class="col-md-2 text-end">
        <label class="form-label">Total</label>
        <div class="form-control text-success fw-bold" id="totalPreview">0.00</div>
      </div>
    </form>

    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>Medicine</th>
            <th>Packing</th>
            <th>Qty</th>
            <th>Rate</th>
            <th>GST%</th>
            <th>Disc%</th>
            <th>Expiry</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="inv : ${invoices}">
            <td th:text="${inv.description}"></td>
            <td th:text="${inv.packing}"></td>
            <td th:text="${inv.qty}"></td>
            <td th:text="${inv.rate}"></td>
            <td th:text="${inv.gst}"></td>
            <td th:text="${inv.discount}"></td>
            <td th:text="${inv.expiryDate}"></td>
            <td th:text="${inv.total}" class="fw-bold text-success"></td>
            <td>
              <form th:action="@{'/invoice/delete/' + ${inv.id}}" method="post" style="display:inline">
                <button type="submit" class="btn btn-danger btn-sm">ðŸ—‘ Delete</button>
              </form>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</body>
</html>
